# Mobile-Application-Privacy-Analytics-Solution
>케이쉴드 주니어 6기 팀 프로젝트 (중국 모바일 어플리케이션의 개인정보 수집과 활용에 관한 분석 및 자동화 방안 연구)
- WBS : https://docs.google.com/spreadsheets/d/1d2tecmpHMVD-wx-GOQ8MbFO2gaJowiYg/edit#gid=1967809667
- 최종보고서 : 앱 분석 결과, 개인정보가 포함되어 있어 미공개
</br>

## 1. 프로젝트 배경
  - 국내에서 카메라, SNS, 게임 등 다방면에서 중국산 어플리케이션 점유율 증가
  - 개인정보처리방침에 기재된 내용을 넘어서 사용자의 개인정보를 과도하게 수집하고 유출하는 어플리케이션의 문제점 대두
  - 우리나라 국민의 낮은 개인정보보호 의식 수준

</br>

## 2. 제작 기간 & 참여 인원  
- 2021년 12월 11일 ~ 12월 25일  
- 팀 구성 (총 10명)
    - 팀장 : 길예슬 
    - PM : 최현우 (본인)   
    - PL : 김경태 
    - 팀원 : 박지형, 정지훈, 조민지, 김정수, 양지안, 조성민, 이혜지  
</br>

## 3. 사용 기술
#### `분석 대상 어플리케이션 (10개)`
  - Ali Express
  - Bigo Live
  - Camera 360
  - Makeup Plus
  - Shareit
  - TikTok
  - ULike
  - WeChat
  - YouCam Makeup

#### `프로젝트 환경 & 툴`  
  - OS : Kali Linux, Windows
  - Mobile : Noxplayer
  - Analysis tool 
      - Static analysis : mobSF, JADX, JEB     
      - Dynamic analysis : Frida, Drozer, ADB, Fiddler, WireShark   
   
#### `프로그래밍 언어`
  - Javascript
  - Python

</br>


## 4. 분석 방법
  - 정적 분석 
    - 개념 : 어플리케이션을 실행하지 않고 소스 코드를 통해 어플리케이션의 구조와 기능을 파악하는 분석 기법
    - 프로세스 :  
      ➤ 개인정보처리방침을 분석한 후, 활용 용도 별로 개인정보를 분류  
      ➤ 개인정보와 관련된 퍼미션 분석  
      ➤ 개인정보처리방침의 내용과 개인정보와 관련된 퍼미션을 바탕으로 개인정보와 관련된 소스코드를 추출하여 동적 분석에 참고할 수 있는 코드 정보 추출, 코드 구조 이해

  - 동적 분석 
    - 개념 : 어플리케이션을 직접 실행하여 어플리케이션의 구조와 기능을 파악하는 분석 기법
    - 프로세스 :  
      ➤ 앱을 실행시켜보며 실제 대상 서비스에서 개인정보 데이터가 저장, 활용되는 기능을 분류  
      ➤ Frida API를 이용하여 Code Injection을 통해 해당 기능이 실행되는 클래스와 메소드 추적  
      ➤ 발견한 메소드, 클래스 부분의 코드를 살펴보며 기능의 동작 방식을 파악하고 구체적으로 어떤 데이터를 저장하고, 패킷으로 전송하는지 살펴본다.

</br>

## 4. 핵심 기능
  - 동적 분석시 활용하기 위한 특정 기능에 활용되는 데이터 추적 코드 구현
    - raptor_frida_android_trace.js 기능 : 앱 실행 시 호출되는 함수를 추적해 함수명, 인자 값, 리턴 값 출력
    - Local_variable_check.py 기능 : 특정 함수에 정의된 지역 변수 값 확인
</br>

## 5. 핵심 트러블 슈팅
  - raptor_frida_android_trace.js (앱 실행 시 호출되는 함수 추적)
    - 문제점 : 몇몇 앱의 경우 앱 패키지명(ex, com.meitu.makeup)을 기준으로 클래스를 불러올 시 그 클래스의 목록에 앱의 기능에 활용되는 클래스가 포함되어 있지 않는 문제가 발생한다.
    - 연구과제 : 앱마다 주요 기능이 활용되는 클래스의 위치가 다르기 때문에 다양한 앱의 패키지에 대한 분석을 진행하여 앱의 기능이 실질적으로 활용되는 클래스만 불러오기 위한 연구가 필요하다.
  
  - Local_variable_check.py (특정 함수의 지역변수 추적)
    - 문제점 :
      - 클래스 변수는 불러올 수 있지만 지역 변수는 불러올 수 있는 방법이 없어 출력이 불가능하다. 
      - Java 고유의 문법과 Identifier(ex. synchronized(this){ })를 자바스크립트로 변환하지 못한다.
    - 연구과제 : 
      - Java code의 Javascript code 변환을 자동화 하는 방법에 대한 연구가 필요
      - Java 고유의 문법과 Identifier(ex. synchronized(this){ })를 자바스크립트로 변환할 방법에 대한 연구가 필요하다. 미리 자바 고유 문법과 자바스크립트 문법의 mapping을 만들어놓는다.

</br>

## 6. 시행착오 / 회고 / 느낀점
>시행착오 및 해결하기 위한 노력:  
 - 프로젝트의 진행 방향에 대한 혼선  
   ➤정적분석을 수행하는 와중에서 Java 소스코드를 한줄 한줄 분석하는 과정에서 난독화되어 있는 부분이 많았고 시간도 많이 소요되는 문제가 발생하였다. 이때 우리는 멘토링을 통해 기존의 정적분석을 수행한후 동적분석으로 넘어가는 계획에서 동적분석을 먼저 수행한후 정적분석으로 넘어가는 것이 좋다는 피드백을 받음으로써 이 문제를 해결할 수 있었다.
 - 일정 차질에 따른 분석 앱 개수 조정   
   ➤기존의 우리 계획은 10개의 앱에 대한 분석 후 연구보고서를 도출하는 것이 목표였다. 하지만 앞에서 얘기드렸다시피 시간이 지연된 부분도 있고 다수의 앱에서 동적분석을 진행하는 과정에서 문제가 발생하여 최종발표를 위해 1개의 앱에 대해서만 우선적으로 분석을 마무리 지었다.  
   동적분석 과정에서 발생한 문제는 ①메인패키지명을 기준으로 클래스와 메소드를 추적하였는데 기타 다른 패키지의 클래스에서 활용되는 기능들이 존재하는 앱에 대해서는 분석을 진행하지 못하여 추후 연구과제로 남겨놓았습니다. ②두번째로는 Frida CLI 환경에 Code Injection시 앱(프로세스)이 종료되는 문제가 발생하여 이러한 문제는 앱 자체적으로 디버거를 탐지하는 것으로 추측되어 향후 연구 과제로 선정하였습니다.     

>프로젝트 개발 회고 글:  
 - 시간관리의 중요성에 대해 다시한번 몸소 느꼈다. 하루하루 스케줄에 버거워하는 인원들이 많았는데, 그만큼 욕심이 많다라는 것을 알았기에 이해가 되었다. 또한, 대부분의 팀원들은 프로젝트 무 경험자였기 때문에 초기에 계획했던 일정대로 프로젝트가 진행되지는 않았다.
  
 - Javascript 코드를 공부하고 이해해야 다음 단계로 넘어갈수 있는 상황에서 코드 분석을 포기해 버리는 팀원이 있었다.
그 당시 나는 충격을 받았는데, 돌아보면 이때가 우리 프로젝트에서 가장 중요한 시기였다.
이 상황에서 나는 PL과 얘기를 주고받으며 Javascript 코드를 공부하고 구글링을 통해 얻은 코드들을 한줄 한줄 분석한 결과를 문서로 만들어 팀원들에게 보내주었다.

 - 솔직히 나는 이때 시간이 촉박하여 참여 의지가 부족한 인원들을 이끌어가는 것이 힘이 부치기도 하고 회의감이 느껴지기도 하였지만, 돌아보면 이 경험을 통해 내 스스로가 한단계 더 성장한것 같다.

 - 마지막으로 프로젝트 초기에 간과했던 것이 있다면 사람이 10명이라고 반드시 10명이서 해야할법한 프로젝트로 방향을 잡고 조사하면 안된다는 것이다. 10명의 인원이 각자 개개인의 능력도 다를뿐더러 반 이상이 프로젝트 경험도 없었기 때문에 이러한 상황에 대한 파악을 제대로 하고 넘어갔어야 했다.

 - 결론적으로 우리는 프로젝트 진행과정(프로젝트 진행 방향성, 프로젝트에 임하는 자세와 태도, 프로젝트의 기술적 완성도 등)에서 우리들은 많은 문제에 봉착했지만 프로젝트를 1등으로 마무리 할 수 있었다.
나는 그래도 아직 가야할 길이 멀다고 생각하기 때문에 이번 프로젝트를 계기로 더 높이 날아오를수 있게 하루하루 항상 최선을 다하는 내가 될수 있게 노력할 것이다.
